{% load static %}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="{% static '/css/dashboard.css' %}">
    <link rel="stylesheet" href="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Mark Attendance Button Styles */
        .mark-attendance-btn {
            background-color: white;
            color: black;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .mark-attendance-btn:hover {
            background-color: rgb(11, 132, 189);
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .mark-attendance-btn:active {
            transform: translateY(0);
        }

        /* Style for the link containing the button */
        .mark-attendance-btn-container {
            display: block;
            width: 100%;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <section id="section-heading">
        <div class="heading-container">
            <div class="left">
                <a href="{% url 'home' %}" class="logo"><img src="{% static '/images/logo.png' %}" alt=""></a>
                <h2>Student Dashboard, Welcome.</h2>
                <form action="" method="post">
                    <input type="search" name="" id="" placeholder="Search">
                    <input type="submit" value="search">
                </form>
            </div>
            {% if user.is_authenticated %}
                <div class="right">
                    <a href=""><i class="fa-solid fa-bell"></i></a>
                    <img src="{% static '/images/dashboard/profile.png' %}" alt="">
                    <h3>{{ user.username }}</h3>
                    <a href="{% url 'logout' %}" class="logout">logout</a>
                </div>
            {% endif %}
        </div>

    </section>



    <section id="dash-section">

        <!-- start div-section-left -->
        <div class="dash-section-left">
            <div class="side-container">
                <img src="/lab/webcam_settings(1).png" alt="">
    
                <div class="side-bar">
                    <ul>
                        <li><a href="">Dashboard</a></li>
                        <li><a href="">Teachers</a></li>
                        <li><a href="">My classes</a></li>
                        <li><a href="{% url 'planning' %}">Schedule</a></li>
                        <li><a href="">Messages</a></li>
                        <li><a href="{% url 'profileUpdate' %}">Profile and Settings</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- end div-section-left -->

        <!-- start div-section-center -->
        <div class="dash-section-center">
            <div class="summary-heading">
                <h2>Summary</h2>
                <select name="" id="">
                    <option value="">1st Semester</option>
                    <option value="">2nd Semester</option>
                </select>
            </div>
    
            <div class="summary-container">
                
                <div class="summary-box">
                    
                    <h2>Attendance</h2>
                    <div class="summary">
                        <img src="{% static 'images/dashboard/attendance.png' %}" alt="">
                        <h2><span>20</span>/20</h2>
                        <p>100%</p>
                    </div>
                    <p>Great, you always attending class, keep it up</p>
                </div>
                <div class="summary-box">
                    <h2>Homework</h2>
                    <div class="summary">
                        <img src="{% static 'images/dashboard/homework.png' %}" alt="">
                        <h2><span>19</span>/20</h2>
                        <p>100%</p>
                    </div>
                    <p>Don't forget about your next homework</p>
                </div>
                <div class="summary-box">
                    <h2>Rating</h2>
                    <div class="summary">
                        <img src="{% static 'images/dashboard/rating.png' %}" alt="">
                        <h2><span>85</span>/100</h2>
                        <p>100%</p>
                    </div>
                    <p>Your progress is very good, keep it up</p>
                </div>
            </div>
        
    
            <div class="schedule-container">
                <div class="schedule-heading">
                    <h2>My Schedule</h2>
                </div>
    
                <div class="calender-events">
                    <div>
                        <div class="calendar-header" style="display: flex; justify-content: center; align-items: center; ">
                            <button id="prevMonthBtn" style="border-radius: 4px; padding: 5px; margin: 5px; background-color: rgb(15, 10, 90); color: white; text-align: center; display: inline-block;">Prev</button>
                            <center style="background-color: rgb(15, 10, 90); padding: 5px; font-size: 25px; border-radius: 8px; color: white;" id="monthName"></center>
                            <button id="nextMonthBtn" style="border-radius: 4px; padding: 5px; margin: 5px; background-color: rgb(15, 10, 90); color: white; text-align: center; display: inline-block;">Next</button>
                        </div>
                        <div id="calendar" style="height: 400px; width: 400px; margin: 10px; border-radius: 2px; box-shadow: 0 0 1px 3px rgb(197, 194, 194);">
                        </div>
                    </div>
                    
                      
                    <!-- <div id="calendar" style="height: 400px; width: 300px; margin: 10px; border-radius: 8px;"> </div> -->
    
    
                
    
                    <div class="events">
                        <div class="event-box">
                            <h3 class="event-name">No class at this time</h3>
                            <div class="event-time">
                                <p></p>
                                <p></p>
                            </div>
                            <a href="#" class="mark-attendance-btn-container">
                                <button class="mark-attendance-btn" disabled>Mark Attendance</button>
                            </a>
                        </div>
    
                        <div class="event-box">
                            <h3 class="event-name">No class at this time</h3>
                            <div class="event-time">
                                <p></p>
                                <p></p>
                            </div>
                            <a href="#" class="mark-attendance-btn-container">
                                <button class="mark-attendance-btn" disabled>Mark Attendance</button>
                            </a>
                        </div>
    
                        <div class="event-box">
                            <h3 class="event-name">No class at this time</h3>
                            <div class="event-time">
                                <p></p>
                                <p></p>
                            </div>
                            <a href="#" class="mark-attendance-btn-container">
                                <button class="mark-attendance-btn" disabled>Mark Attendance</button>
                            </a>
                        </div>


                        <!-- <div class="event-box classes">
                            <h3 class="event-name">Natural Language Processing</h3>
                            <div class="event-time">
                                <p>15.09</p>
                                <p>11.00am - 1.00pm</p>
                            </div>
                        </div>
    
                        <div class="event-box event-box-child">
                            <h3 class="event-name">Artificial Intelligence</h3>
                            <div class="event-time">
                                <p>15.09</p>
                                <p>11.00am - 1.00pm</p>
                            </div>
                        </div>
    
                        <div class="event-box event-box-child">
                            <h3 class="event-name">Neural Networks</h3>
                            <div class="event-time">
                                <p>15.09</p>
                                <p>13.00pm - 16.00pm</p>
                            </div>
                        </div>
     -->
                        <!-- <div class="event-box event-box-child">
                            <h3 class="event-name">Software Project Management</h3>
                            <div class="event-time">
                                <p>15.09</p>
                                <p>7.00am - 10.00am</p> -->
                            </div>
                        </div>
    
                    </div>
                </div>
            </div>
        </div>
        <!-- end div-section-center -->

        <div class="dash-section-right">
            <div class="teacher-events-container">
                    <div class="teachers">
                        <h2>My Teachers</h2>
                        <div class="teacher-box">
                            <img src="{% static '/images/dashboard/teacher.jpg' %}" alt="">
                            <span><h2>Sila Mulingi</h2>
                            <br>
                            <p>Javascript and C</p></span>
                            <a href="mailto:silamulingi@gmail.com"><i class="fa-solid fa-envelope-open-text"></i></a>
                        </div>
    
                        <div class="teacher-box">
                            <img src="{% static '/images/dashboard/teacher.jpg' %}" alt="">
                            <span><h2>Sila Mulingi</h2>
                            <br>
                            <p>Javascript and C</p></span>
                            <a href="mailto:silamulingi@gmail.com"><i class="fa-solid fa-envelope-open-text"></i></a>
                        </div>
    
                        <div class="teacher-box">
                            <img src="{% static '/images/dashboard/teacher.jpg' %}" alt="">
                            <span><h2>Sila Mulingi</h2>
                            <br>
                            <p>Javascript and C</p></span>
                            <a href="mailto:silamulingi@gmail.com"><i class="fa-solid fa-envelope-open-text"></i></a>
                        </div>
                    </div>

                    <div class="events">
                        <h2>Up-Coming Events</h2>
                        <div class="event-box">
                            <div class="image">
                                <img src="{% static '/images/dashboard/event1.jpg' %}" alt="">
                            </div>

                            <div class="title">
                                <h2>Coding: what is it eaten with</h2>
                                <div class="time">
                                    <p>11.3.2025</p>
                                    <p>14.00pm</p>
                                    <a href=""><i class="fa-solid fa-ellipsis-vertical"></i></a>
                                </div>
                            </div>
                        </div>

                        <div class="event-box">
                            <div class="image">
                                <img src="{% static '/images/dashboard/event2.jpg' %}" alt="">
                            </div>

                            <div class="title">
                                <h2>Coding: what is it eaten with</h2>
                                <div class="time">
                                    <p>11.3.2025</p>
                                    <p>14.00pm</p>
                                    <a href=""><i class="fa-solid fa-ellipsis-vertical"></i></a>
                                </div>
                            </div>
                        </div>

                        <div class="event-box">
                            <div class="image">
                                <img src="{% static '/images/dashboard/event3.jpg' %}" alt="">
                            </div>

                            <div class="title">
                                <h2>Coding: what is it eaten with</h2>
                                <div class="time">
                                    <p>11.3.2025</p>
                                    <p>14.00pm</p>
                                    <a href=""><i class="fa-solid fa-ellipsis-vertical"></i></a>
                                </div>
                            </div>
                        </div>

                        <div class="event-box">
                            <div class="image">
                                <img src="{% static '/images/dashboard/event4.jpg' %}" alt="">
                            </div>

                            <div class="title">
                                <h2>Coding: what is it eaten with</h2>
                                <div class="time">
                                    <p>11.3.2025</p>
                                    <p>14.00pm</p>
                                    <a href=""><i class="fa-solid fa-ellipsis-vertical"></i></a>
                                </div>
                            </div>
                        </div>

                        
                        
                        
                    </div>
            </div>

        </div>



        
    </section>


  <script src="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.js"></script>
  <script>
    const calendar = new tui.Calendar('#calendar', {
      defaultView: 'month', // Default view is set to 'month'
      useCreationPopup: true,
      useDetailPopup: true,
      calendars: [
        {
          id: 'cal1',
          name: 'Personal',
          backgroundColor: '#03bd9e',
        },
      ],
    });

    // Function to update the month name
    const updateMonthName = () => {
      const date = calendar.getDate();
      const monthName = new Intl.DateTimeFormat('default', { month: 'long' }).format(date);
      document.getElementById('monthName').textContent = monthName;
    };

    // Initial month name update
    updateMonthName();

    // Previous month button
    document.getElementById('prevMonthBtn').addEventListener('click', () => {
      calendar.prev();
      updateMonthName();
    });

    // Next month button
    document.getElementById('nextMonthBtn').addEventListener('click', () => {
      calendar.next();
      updateMonthName();
    });

    // Fetch and display events
    async function fetchAndDisplayEvents() {
        try {
            const response = await fetch('/api/tasks/');
            const events = await response.json();
            
            // Get current date in YYYY-MM-DD format
            const today = new Date();
            const currentDate = today.toISOString().split('T')[0];
            
            // Filter events for current date
            const todayEvents = events.filter(event => {
                const eventDate = new Date(event.start).toISOString().split('T')[0];
                return eventDate === currentDate;
            });
            
            // Get all event boxes
            const eventBoxes = document.querySelectorAll('.events .event-box');
            
            // Update each event box with the fetched data
            todayEvents.slice(0, 3).forEach((event, index) => {
                if (eventBoxes[index]) {
                    const eventName = eventBoxes[index].querySelector('.event-name');
                    const eventTime = eventBoxes[index].querySelector('.event-time');
                    const markAttendanceBtn = eventBoxes[index].querySelector('.mark-attendance-btn');
                    const markAttendanceLink = eventBoxes[index].querySelector('.mark-attendance-btn-container');
                    
                    if (eventName) {
                        eventName.textContent = event.title || 'No Class during this time';
                    }
                    
                    if (eventTime) {
                        const timeElement = eventTime.querySelector('p:last-child');
                        if (timeElement) {
                            const startTime = new Date(event.start).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
                            const endTime = new Date(event.end).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
                            timeElement.textContent = `${startTime} - ${endTime}` || 'No Time';
                        }
                    }

                    // Update mark attendance button
                    if (markAttendanceBtn && markAttendanceLink) {
                        markAttendanceBtn.disabled = false;
                        markAttendanceLink.href = `/mark-attendance/${event.title}/`;
                    }
                }
            });

            // If no events for today, show "No classes today" message
            if (todayEvents.length === 0) {
                eventBoxes.forEach(box => {
                    const eventName = box.querySelector('.event-name');
                    if (eventName) {
                        eventName.textContent = 'No classes today';
                    }
                });
            }
        } catch (error) {
            console.error('Error fetching events:', error);
        }
    }

    // Call the function when the page loads
    fetchAndDisplayEvents();

  </script>
</body>
</html>





